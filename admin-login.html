<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Hack Club — Admin Login</title>
  <link rel="stylesheet" href="assets/css/styles.css" />

  <!-- Local fallback + config -->
  <script defer src="assets/js/storage.js?v=8"></script>
  <script defer src="assets/js/config.js?v=8"></script>

  <!-- Firebase (compat) -->
  <script defer src="https://www.gstatic.com/firebasejs/10.12.3/firebase-app-compat.js"></script>
  <script defer src="https://www.gstatic.com/firebasejs/10.12.3/firebase-auth-compat.js"></script>
  <script defer src="https://www.gstatic.com/firebasejs/10.12.3/firebase-firestore-compat.js"></script>

  <!-- Remote Storage wrapper -->
  <script defer src="assets/js/storage.remote.js?v=8"></script>
  <script defer src="assets/js/ui.js?v=8"></script>
</head>
<body class="theme-gradient">
  <main class="section-pad">
    <div class="container narrow">
      <h1>Admin Login</h1>
      <form id="login-form" class="form card">
        <label>Email <input type="email" id="username" required autocomplete="username" /></label>
        <label>Password <input type="password" id="password" required autocomplete="current-password" /></label>
        <button class="btn btn-primary" type="submit" id="login-btn">Login</button>
        <div id="login-msg" class="msg muted" style="margin-top:10px"></div>
      </form>
    </div>
  </main>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // Wait for auth to initialize; if already logged in, forward to admin
      if (!window.firebase?.auth) return console.error('Firebase not loaded');
      const stop = firebase.auth().onAuthStateChanged(user => {
        if (user) { stop(); location.replace('admin.html'); }
      });

      const form = document.getElementById('login-form');
      const userEl = document.getElementById('username');
      const passEl = document.getElementById('password');
      const btn = document.getElementById('login-btn');
      const msg = document.getElementById('login-msg');
      const setMsg = (t, typ='muted') => { msg.textContent=t||''; msg.className='msg '+typ; };

      form.addEventListener('submit', async (e) => {
        e.preventDefault();
        try {
          btn.disabled = true; btn.textContent = 'Logging in…';
          await window.StorageAPI.login(userEl.value.trim(), passEl.value);
          setMsg('Login successful', 'success');
          location.replace('admin.html');
        } catch (err) {
          console.error(err);
          setMsg((err?.code || '') + ' ' + (err?.message || 'Login failed'), 'error');
        } finally {
          btn.disabled = false; btn.textContent = 'Login';
        }
      });
    });
  </script>
</body>
</html>
